6d8b0d46c3ca41f7c676d9fa7783b465
"use strict";
/*
 * Copyright 2017 Palantir Technologies, Inc. All rights reserved.
 *
 * Licensed under the terms of the LICENSE file distributed with this project.
 */
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Returns true if the arrays are equal. Elements will be shallowly compared by
 * default, or they will be compared using the custom `compare` function if one
 * is provided.
 */
function arraysEqual(arrA, arrB, compare = (a, b) => a === b) {
    // treat `null` and `undefined` as the same
    if (arrA == null && arrB == null) {
        return true;
    }
    else if (arrA == null || arrB == null || arrA.length !== arrB.length) {
        return false;
    }
    else {
        return arrA.every((a, i) => compare(a, arrB[i]));
    }
}
exports.arraysEqual = arraysEqual;
/**
 * Shallow comparison between objects. If `keys` is provided, just that subset
 * of keys will be compared; otherwise, all keys will be compared.
 */
function shallowCompareKeys(objA, objB, keys) {
    // treat `null` and `undefined` as the same
    if (objA == null && objB == null) {
        return true;
    }
    else if (objA == null || objB == null) {
        return false;
    }
    else if (Array.isArray(objA) || Array.isArray(objB)) {
        return false;
    }
    else if (keys != null) {
        return _shallowCompareKeys(objA, objB, keys);
    }
    else {
        // shallowly compare all keys from both objects
        const keysA = Object.keys(objA);
        const keysB = Object.keys(objB);
        return (_shallowCompareKeys(objA, objB, { include: keysA }) && _shallowCompareKeys(objA, objB, { include: keysB }));
    }
}
exports.shallowCompareKeys = shallowCompareKeys;
/**
 * Deep comparison between objects. If `keys` is provided, just that subset of
 * keys will be compared; otherwise, all keys will be compared.
 */
function deepCompareKeys(objA, objB, keys) {
    if (objA === objB) {
        return true;
    }
    else if (objA == null && objB == null) {
        // treat `null` and `undefined` as the same
        return true;
    }
    else if (objA == null || objB == null) {
        return false;
    }
    else if (Array.isArray(objA) || Array.isArray(objB)) {
        return arraysEqual(objA, objB, deepCompareKeys);
    }
    else if (_isSimplePrimitiveType(objA) || _isSimplePrimitiveType(objB)) {
        return objA === objB;
    }
    else if (keys != null) {
        return _deepCompareKeys(objA, objB, keys);
    }
    else if (objA.constructor !== objB.constructor) {
        return false;
    }
    else {
        const keysA = Object.keys(objA);
        const keysB = Object.keys(objB);
        if (keysA == null || keysB == null) {
            return false;
        }
        if (keysA.length === 0 && keysB.length === 0) {
            return true;
        }
        return arraysEqual(keysA, keysB) && _deepCompareKeys(objA, objB, keysA);
    }
}
exports.deepCompareKeys = deepCompareKeys;
/**
 * Returns a descriptive object for each key whose values are shallowly unequal
 * between two provided objects. Useful for debugging shouldComponentUpdate.
 */
function getShallowUnequalKeyValues(objA, objB, keys) {
    // default param values let null values pass through, so we have to take
    // this more thorough approach
    const definedObjA = objA === null ? {} : objA;
    const definedObjB = objB === null ? {} : objB;
    const filteredKeys = _filterKeys(definedObjA, definedObjB, keys == null ? { exclude: [] } : keys);
    return _getUnequalKeyValues(definedObjA, definedObjB, filteredKeys, (a, b, key) => {
        return shallowCompareKeys(a, b, { include: [key] });
    });
}
exports.getShallowUnequalKeyValues = getShallowUnequalKeyValues;
/**
 * Returns a descriptive object for each key whose values are deeply unequal
 * between two provided objects. Useful for debugging shouldComponentUpdate.
 */
function getDeepUnequalKeyValues(objA = {}, objB = {}, keys) {
    const filteredKeys = keys == null ? _unionKeys(objA, objB) : keys;
    return _getUnequalKeyValues(objA, objB, filteredKeys, (a, b, key) => {
        return deepCompareKeys(a, b, [key]);
    });
}
exports.getDeepUnequalKeyValues = getDeepUnequalKeyValues;
// Private helpers
// ===============
/**
 * Partial shallow comparison between objects using the given list of keys.
 */
function _shallowCompareKeys(objA, objB, keys) {
    return _filterKeys(objA, objB, keys).every(key => {
        return objA.hasOwnProperty(key) === objB.hasOwnProperty(key) && objA[key] === objB[key];
    });
}
/**
 * Partial deep comparison between objects using the given list of keys.
 */
function _deepCompareKeys(objA, objB, keys) {
    return keys.every(key => {
        return objA.hasOwnProperty(key) === objB.hasOwnProperty(key) && deepCompareKeys(objA[key], objB[key]);
    });
}
function _isSimplePrimitiveType(value) {
    return typeof value === "number" || typeof value === "string" || typeof value === "boolean";
}
function _filterKeys(objA, objB, keys) {
    if (_isWhitelist(keys)) {
        return keys.include;
    }
    else {
        const keysA = Object.keys(objA);
        const keysB = Object.keys(objB);
        // merge keys from both objects into a big set for quick access
        const keySet = _arrayToObject(keysA.concat(keysB));
        // delete blacklisted keys from the key set
        if (keys["exclude"]) {
            keys["exclude"].forEach(key => delete keySet[key]);
        }
        // return the remaining keys as an array
        return Object.keys(keySet);
    }
}
function _isWhitelist(keys) {
    return keys != null && keys.include != null;
}
function _arrayToObject(arr) {
    return arr.reduce((obj, element) => {
        obj[element] = true;
        return obj;
    }, {});
}
function _getUnequalKeyValues(objA, objB, keys, compareFn) {
    const unequalKeys = keys.filter(key => !compareFn(objA, objB, key));
    const unequalKeyValues = unequalKeys.map(key => ({
        key,
        valueA: objA[key],
        valueB: objB[key],
    }));
    return unequalKeyValues;
}
function _unionKeys(objA, objB) {
    const keysA = Object.keys(objA);
    const keysB = Object.keys(objB);
    const concatKeys = keysA.concat(keysB);
    const keySet = _arrayToObject(concatKeys);
    return Object.keys(keySet);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVoQyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUUxQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFtQixDQUFDO0FBQ2pELENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvam0vUHJvamVjdHMvTW9kdWxlcy9mcC9zcmMvY29tcGFyZS11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBDb3B5cmlnaHQgMjAxNyBQYWxhbnRpciBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBMSUNFTlNFIGZpbGUgZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHByb2plY3QuXHJcbiAqL1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJS2V5V2hpdGVsaXN0PFQ+IHtcclxuICAgIGluY2x1ZGU6IEFycmF5PGtleW9mIFQ+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElLZXlCbGFja2xpc3Q8VD4ge1xyXG4gICAgZXhjbHVkZTogQXJyYXk8a2V5b2YgVD47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIGFycmF5cyBhcmUgZXF1YWwuIEVsZW1lbnRzIHdpbGwgYmUgc2hhbGxvd2x5IGNvbXBhcmVkIGJ5XHJcbiAqIGRlZmF1bHQsIG9yIHRoZXkgd2lsbCBiZSBjb21wYXJlZCB1c2luZyB0aGUgY3VzdG9tIGBjb21wYXJlYCBmdW5jdGlvbiBpZiBvbmVcclxuICogaXMgcHJvdmlkZWQuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYXJyYXlzRXF1YWwoYXJyQTogYW55W10sIGFyckI6IGFueVtdLCBjb21wYXJlID0gKGE6IGFueSwgYjogYW55KSA9PiBhID09PSBiKSB7XHJcbiAgICAvLyB0cmVhdCBgbnVsbGAgYW5kIGB1bmRlZmluZWRgIGFzIHRoZSBzYW1lXHJcbiAgICBpZiAoYXJyQSA9PSBudWxsICYmIGFyckIgPT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIGlmIChhcnJBID09IG51bGwgfHwgYXJyQiA9PSBudWxsIHx8IGFyckEubGVuZ3RoICE9PSBhcnJCLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGFyckEuZXZlcnkoKGEsIGkpID0+IGNvbXBhcmUoYSwgYXJyQltpXSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hhbGxvdyBjb21wYXJpc29uIGJldHdlZW4gb2JqZWN0cy4gSWYgYGtleXNgIGlzIHByb3ZpZGVkLCBqdXN0IHRoYXQgc3Vic2V0XHJcbiAqIG9mIGtleXMgd2lsbCBiZSBjb21wYXJlZDsgb3RoZXJ3aXNlLCBhbGwga2V5cyB3aWxsIGJlIGNvbXBhcmVkLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNoYWxsb3dDb21wYXJlS2V5czxUIGV4dGVuZHMgb2JqZWN0PihvYmpBOiBULCBvYmpCOiBULCBrZXlzPzogSUtleUJsYWNrbGlzdDxUPiB8IElLZXlXaGl0ZWxpc3Q8VD4pIHtcclxuICAgIC8vIHRyZWF0IGBudWxsYCBhbmQgYHVuZGVmaW5lZGAgYXMgdGhlIHNhbWVcclxuICAgIGlmIChvYmpBID09IG51bGwgJiYgb2JqQiA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2UgaWYgKG9iakEgPT0gbnVsbCB8fCBvYmpCID09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqQSkgfHwgQXJyYXkuaXNBcnJheShvYmpCKSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0gZWxzZSBpZiAoa2V5cyAhPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zaGFsbG93Q29tcGFyZUtleXMob2JqQSwgb2JqQiwga2V5cyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIHNoYWxsb3dseSBjb21wYXJlIGFsbCBrZXlzIGZyb20gYm90aCBvYmplY3RzXHJcbiAgICAgICAgY29uc3Qga2V5c0EgPSBPYmplY3Qua2V5cyhvYmpBKSBhcyBBcnJheTxrZXlvZiBUPjtcclxuICAgICAgICBjb25zdCBrZXlzQiA9IE9iamVjdC5rZXlzKG9iakIpIGFzIEFycmF5PGtleW9mIFQ+O1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIF9zaGFsbG93Q29tcGFyZUtleXMob2JqQSwgb2JqQiwgeyBpbmNsdWRlOiBrZXlzQSB9KSAmJiBfc2hhbGxvd0NvbXBhcmVLZXlzKG9iakEsIG9iakIsIHsgaW5jbHVkZToga2V5c0IgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVlcCBjb21wYXJpc29uIGJldHdlZW4gb2JqZWN0cy4gSWYgYGtleXNgIGlzIHByb3ZpZGVkLCBqdXN0IHRoYXQgc3Vic2V0IG9mXHJcbiAqIGtleXMgd2lsbCBiZSBjb21wYXJlZDsgb3RoZXJ3aXNlLCBhbGwga2V5cyB3aWxsIGJlIGNvbXBhcmVkLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGRlZXBDb21wYXJlS2V5cyhvYmpBOiBhbnksIG9iakI6IGFueSwga2V5cz86IHN0cmluZ1tdKTogYm9vbGVhbiB7XHJcbiAgICBpZiAob2JqQSA9PT0gb2JqQikge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIGlmIChvYmpBID09IG51bGwgJiYgb2JqQiA9PSBudWxsKSB7XHJcbiAgICAgICAgLy8gdHJlYXQgYG51bGxgIGFuZCBgdW5kZWZpbmVkYCBhcyB0aGUgc2FtZVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIGlmIChvYmpBID09IG51bGwgfHwgb2JqQiA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iakEpIHx8IEFycmF5LmlzQXJyYXkob2JqQikpIHtcclxuICAgICAgICByZXR1cm4gYXJyYXlzRXF1YWwob2JqQSwgb2JqQiwgZGVlcENvbXBhcmVLZXlzKTtcclxuICAgIH0gZWxzZSBpZiAoX2lzU2ltcGxlUHJpbWl0aXZlVHlwZShvYmpBKSB8fCBfaXNTaW1wbGVQcmltaXRpdmVUeXBlKG9iakIpKSB7XHJcbiAgICAgICAgcmV0dXJuIG9iakEgPT09IG9iakI7XHJcbiAgICB9IGVsc2UgaWYgKGtleXMgIT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBfZGVlcENvbXBhcmVLZXlzKG9iakEsIG9iakIsIGtleXMpO1xyXG4gICAgfSBlbHNlIGlmIChvYmpBLmNvbnN0cnVjdG9yICE9PSBvYmpCLmNvbnN0cnVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBrZXlzQSA9IE9iamVjdC5rZXlzKG9iakEpO1xyXG4gICAgICAgIGNvbnN0IGtleXNCID0gT2JqZWN0LmtleXMob2JqQik7XHJcbiAgICAgICAgaWYgKGtleXNBID09IG51bGwgfHwga2V5c0IgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChrZXlzQS5sZW5ndGggPT09IDAgJiYga2V5c0IubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXJyYXlzRXF1YWwoa2V5c0EsIGtleXNCKSAmJiBfZGVlcENvbXBhcmVLZXlzKG9iakEsIG9iakIsIGtleXNBKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSBkZXNjcmlwdGl2ZSBvYmplY3QgZm9yIGVhY2gga2V5IHdob3NlIHZhbHVlcyBhcmUgc2hhbGxvd2x5IHVuZXF1YWxcclxuICogYmV0d2VlbiB0d28gcHJvdmlkZWQgb2JqZWN0cy4gVXNlZnVsIGZvciBkZWJ1Z2dpbmcgc2hvdWxkQ29tcG9uZW50VXBkYXRlLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNoYWxsb3dVbmVxdWFsS2V5VmFsdWVzPFQgZXh0ZW5kcyBvYmplY3Q+KFxyXG4gICAgb2JqQTogVCxcclxuICAgIG9iakI6IFQsXHJcbiAgICBrZXlzPzogSUtleUJsYWNrbGlzdDxUPiB8IElLZXlXaGl0ZWxpc3Q8VD4sXHJcbikge1xyXG4gICAgLy8gZGVmYXVsdCBwYXJhbSB2YWx1ZXMgbGV0IG51bGwgdmFsdWVzIHBhc3MgdGhyb3VnaCwgc28gd2UgaGF2ZSB0byB0YWtlXHJcbiAgICAvLyB0aGlzIG1vcmUgdGhvcm91Z2ggYXBwcm9hY2hcclxuICAgIGNvbnN0IGRlZmluZWRPYmpBID0gb2JqQSA9PT0gbnVsbCA/IHt9IDogb2JqQTtcclxuICAgIGNvbnN0IGRlZmluZWRPYmpCID0gb2JqQiA9PT0gbnVsbCA/IHt9IDogb2JqQjtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJlZEtleXMgPSBfZmlsdGVyS2V5cyhkZWZpbmVkT2JqQSBhcyBULCBkZWZpbmVkT2JqQiBhcyBULCBrZXlzID09IG51bGwgPyB7IGV4Y2x1ZGU6IFtdIH0gOiBrZXlzKTtcclxuICAgIHJldHVybiBfZ2V0VW5lcXVhbEtleVZhbHVlcyhkZWZpbmVkT2JqQSBhcyBULCBkZWZpbmVkT2JqQiBhcyBULCBmaWx0ZXJlZEtleXMsIChhLCBiLCBrZXkpID0+IHtcclxuICAgICAgICByZXR1cm4gc2hhbGxvd0NvbXBhcmVLZXlzKGEsIGIsIHsgaW5jbHVkZTogW2tleV0gfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSBkZXNjcmlwdGl2ZSBvYmplY3QgZm9yIGVhY2gga2V5IHdob3NlIHZhbHVlcyBhcmUgZGVlcGx5IHVuZXF1YWxcclxuICogYmV0d2VlbiB0d28gcHJvdmlkZWQgb2JqZWN0cy4gVXNlZnVsIGZvciBkZWJ1Z2dpbmcgc2hvdWxkQ29tcG9uZW50VXBkYXRlLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZXBVbmVxdWFsS2V5VmFsdWVzPFQgZXh0ZW5kcyBvYmplY3Q+KFxyXG4gICAgb2JqQTogVCA9ICh7fSBhcyBhbnkpIGFzIFQsXHJcbiAgICBvYmpCOiBUID0gKHt9IGFzIGFueSkgYXMgVCxcclxuICAgIGtleXM/OiBBcnJheTxrZXlvZiBUPixcclxuKSB7XHJcbiAgICBjb25zdCBmaWx0ZXJlZEtleXMgPSBrZXlzID09IG51bGwgPyBfdW5pb25LZXlzKG9iakEsIG9iakIpIDoga2V5cztcclxuICAgIHJldHVybiBfZ2V0VW5lcXVhbEtleVZhbHVlcyhvYmpBLCBvYmpCLCBmaWx0ZXJlZEtleXMsIChhLCBiLCBrZXkpID0+IHtcclxuICAgICAgICByZXR1cm4gZGVlcENvbXBhcmVLZXlzKGEsIGIsIFtrZXkgYXMgc3RyaW5nXSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gUHJpdmF0ZSBoZWxwZXJzXHJcbi8vID09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIFBhcnRpYWwgc2hhbGxvdyBjb21wYXJpc29uIGJldHdlZW4gb2JqZWN0cyB1c2luZyB0aGUgZ2l2ZW4gbGlzdCBvZiBrZXlzLlxyXG4gKi9cclxuZnVuY3Rpb24gX3NoYWxsb3dDb21wYXJlS2V5czxUPihvYmpBOiBULCBvYmpCOiBULCBrZXlzOiBJS2V5QmxhY2tsaXN0PFQ+IHwgSUtleVdoaXRlbGlzdDxUPikge1xyXG4gICAgcmV0dXJuIF9maWx0ZXJLZXlzKG9iakEsIG9iakIsIGtleXMpLmV2ZXJ5KGtleSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9iakEuaGFzT3duUHJvcGVydHkoa2V5KSA9PT0gb2JqQi5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIG9iakFba2V5XSA9PT0gb2JqQltrZXldO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJ0aWFsIGRlZXAgY29tcGFyaXNvbiBiZXR3ZWVuIG9iamVjdHMgdXNpbmcgdGhlIGdpdmVuIGxpc3Qgb2Yga2V5cy5cclxuICovXHJcbmZ1bmN0aW9uIF9kZWVwQ29tcGFyZUtleXMob2JqQTogYW55LCBvYmpCOiBhbnksIGtleXM6IHN0cmluZ1tdKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4ga2V5cy5ldmVyeShrZXkgPT4ge1xyXG4gICAgICAgIHJldHVybiBvYmpBLmhhc093blByb3BlcnR5KGtleSkgPT09IG9iakIuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBkZWVwQ29tcGFyZUtleXMob2JqQVtrZXldLCBvYmpCW2tleV0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9pc1NpbXBsZVByaW1pdGl2ZVR5cGUodmFsdWU6IGFueSkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIjtcclxufVxyXG5cclxuZnVuY3Rpb24gX2ZpbHRlcktleXM8VD4ob2JqQTogVCwgb2JqQjogVCwga2V5czogSUtleUJsYWNrbGlzdDxUPiB8IElLZXlXaGl0ZWxpc3Q8VD4pIHtcclxuICAgIGlmIChfaXNXaGl0ZWxpc3Qoa2V5cykpIHtcclxuICAgICAgICByZXR1cm4ga2V5cy5pbmNsdWRlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBrZXlzQSA9IE9iamVjdC5rZXlzKG9iakEpO1xyXG4gICAgICAgIGNvbnN0IGtleXNCID0gT2JqZWN0LmtleXMob2JqQik7XHJcblxyXG4gICAgICAgIC8vIG1lcmdlIGtleXMgZnJvbSBib3RoIG9iamVjdHMgaW50byBhIGJpZyBzZXQgZm9yIHF1aWNrIGFjY2Vzc1xyXG4gICAgICAgIGNvbnN0IGtleVNldCA9IF9hcnJheVRvT2JqZWN0KGtleXNBLmNvbmNhdChrZXlzQikpO1xyXG5cclxuICAgICAgICAvLyBkZWxldGUgYmxhY2tsaXN0ZWQga2V5cyBmcm9tIHRoZSBrZXkgc2V0XHJcbiAgICAgICAgaWYgKGtleXNbXCJleGNsdWRlXCJdKXtcclxuICAgICAgICAgICAga2V5c1tcImV4Y2x1ZGVcIl0uZm9yRWFjaChrZXkgPT4gZGVsZXRlIGtleVNldFtrZXldKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJldHVybiB0aGUgcmVtYWluaW5nIGtleXMgYXMgYW4gYXJyYXlcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoa2V5U2V0KSBhcyBBcnJheTxrZXlvZiBUPjtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gX2lzV2hpdGVsaXN0PFQ+KGtleXM6IGFueSk6IGtleXMgaXMgSUtleVdoaXRlbGlzdDxUPiB7XHJcbiAgICByZXR1cm4ga2V5cyAhPSBudWxsICYmIChrZXlzIGFzIElLZXlXaGl0ZWxpc3Q8VD4pLmluY2x1ZGUgIT0gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gX2FycmF5VG9PYmplY3QoYXJyOiBhbnlbXSkge1xyXG4gICAgcmV0dXJuIGFyci5yZWR1Y2UoKG9iajogYW55LCBlbGVtZW50OiBhbnkpID0+IHtcclxuICAgICAgICBvYmpbZWxlbWVudF0gPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9LCB7fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9nZXRVbmVxdWFsS2V5VmFsdWVzPFQgZXh0ZW5kcyBvYmplY3Q+KFxyXG4gICAgb2JqQTogVCxcclxuICAgIG9iakI6IFQsXHJcbiAgICBrZXlzOiBBcnJheTxrZXlvZiBUPixcclxuICAgIGNvbXBhcmVGbjogKG9iakE6IGFueSwgb2JqQjogYW55LCBrZXk6IGtleW9mIFQpID0+IGJvb2xlYW4sXHJcbikge1xyXG4gICAgY29uc3QgdW5lcXVhbEtleXMgPSBrZXlzLmZpbHRlcihrZXkgPT4gIWNvbXBhcmVGbihvYmpBLCBvYmpCLCBrZXkpKTtcclxuICAgIGNvbnN0IHVuZXF1YWxLZXlWYWx1ZXMgPSB1bmVxdWFsS2V5cy5tYXAoa2V5ID0+ICh7XHJcbiAgICAgICAga2V5LFxyXG4gICAgICAgIHZhbHVlQTogb2JqQVtrZXldLFxyXG4gICAgICAgIHZhbHVlQjogb2JqQltrZXldLFxyXG4gICAgfSkpO1xyXG4gICAgcmV0dXJuIHVuZXF1YWxLZXlWYWx1ZXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF91bmlvbktleXM8VCBleHRlbmRzIG9iamVjdD4ob2JqQTogVCwgb2JqQjogVCkge1xyXG4gICAgY29uc3Qga2V5c0EgPSBPYmplY3Qua2V5cyhvYmpBKTtcclxuICAgIGNvbnN0IGtleXNCID0gT2JqZWN0LmtleXMob2JqQik7XHJcblxyXG4gICAgY29uc3QgY29uY2F0S2V5cyA9IGtleXNBLmNvbmNhdChrZXlzQik7XHJcbiAgICBjb25zdCBrZXlTZXQgPSBfYXJyYXlUb09iamVjdChjb25jYXRLZXlzKTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoa2V5U2V0KSBhcyBBcnJheTxrZXlvZiBUPjtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=